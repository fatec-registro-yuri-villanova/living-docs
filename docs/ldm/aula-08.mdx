---
sidebar_position: 8
title: "Aula 08: Streak e GamificaÃ§Ã£o Server"
description: "LÃ³gica de streak no servidor â€” cÃ¡lculo de dias consecutivos, XP e badges."
---

# Aula 08: Streak e GamificaÃ§Ã£o Server

:::info ğŸ”€ Branch da Aula
Esta aula refere-se Ã  branch: **`aula-08`** â€” `git checkout aula-08`
:::

:::caution ğŸš§ ConteÃºdo Prospectivo
Esta branch ainda nÃ£o possui cÃ³digo implementado.
:::

## ğŸ“– Conceito

O streak (ofensiva) Ã© calculado no server para evitar manipulaÃ§Ã£o. Quando o aluno completa uma atividade, o server verifica a Ãºltima atividade e incrementa ou reseta o streak.

## ğŸ’» CÃ³digo de ReferÃªncia

```kotlin title="server/.../services/StreakService.kt"
class StreakService(private val supabase: SupabaseClient) {
    suspend fun updateStreak(userId: String): StreakResult {
        val lastActivity = getLastActivity(userId)
        val today = Clock.System.now().toLocalDateTime(TimeZone.currentSystemDefault()).date
        val yesterday = today.minus(1, DateTimeUnit.DAY)

        return when (lastActivity?.date) {
            today -> StreakResult(maintained = true, count = lastActivity.streakCount)
            yesterday -> {
                val newCount = lastActivity.streakCount + 1
                saveStreak(userId, today, newCount)
                StreakResult(maintained = true, count = newCount)
            }
            else -> {
                saveStreak(userId, today, 1)
                StreakResult(maintained = false, count = 1)
            }
        }
    }
}
```

## ğŸ’» MÃ£o na Massa

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="ex1" label="ExercÃ­cio 1 â€” FixaÃ§Ã£o" default>

Integre `StreakService.updateStreak()` no endpoint de submissÃ£o do quiz.

  </TabItem>
  <TabItem value="ex2" label="ExercÃ­cio 2 â€” AplicaÃ§Ã£o">

Crie endpoint `GET /api/users/me/stats` que retorne streak, XP total e badges.

  </TabItem>
  <TabItem value="ex3" label="ExercÃ­cio 3 â€” Desafio">

Implemente badges automÃ¡ticos (3 dias = "Iniciante", 7 = "Dedicado", 30 = "Mestre") com insert no Supabase.

  </TabItem>
</Tabs>
