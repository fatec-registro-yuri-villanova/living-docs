---
sidebar_position: 1
title: "Aula 01: Setup KMP e Ktor Server"
description: "Kotlin Multiplatform com shared module, Ktor Server e health endpoint."
---

# Aula 01: Setup KMP e Ktor Server

:::info ðŸ”€ Branch da Aula
Esta aula refere-se Ã  branch: **`aula-01`**
```bash
git checkout aula-01
```
:::

## ðŸ“– Conceito

O **Kotlin Multiplatform (KMP)** permite compartilhar lÃ³gica entre Server, Desktop e Mobile. O projeto possui 3 mÃ³dulos:

| MÃ³dulo | FunÃ§Ã£o |
|--------|--------|
| `shared/` | LÃ³gica compartilhada (expect/actual, models) |
| `server/` | Backend Ktor (API REST) |
| `composeApp/` | CMS Desktop com Compose for Desktop |

## ðŸ’» CÃ³digo de ReferÃªncia

### Application.kt â€” Servidor Ktor

```kotlin title="server/src/main/kotlin/.../Application.kt"
fun main() {
    val port = System.getenv("PORT")?.toIntOrNull() ?: 8080
    embeddedServer(Netty, port = port, host = "0.0.0.0",
                   module = Application::module)
        .start(wait = true)
}

@Serializable
data class HealthResponse(
    val status: String,
    val timestamp: Long
)

fun Application.module() {
    install(ContentNegotiation) {
        json(Json {
            prettyPrint = true
            isLenient = true
            ignoreUnknownKeys = true
        })
    }

    routing {
        get("/") {
            call.respondText("API LDDM/PDM (Aula 01). Tente acessar /api/health")
        }

        get("/api/health") {
            call.respond(
                HealthResponse(
                    status = "Status UP",
                    timestamp = System.currentTimeMillis()
                )
            )
        }
    }
}
```

### Platform Interface â€” expect/actual

```kotlin title="shared/src/commonMain/kotlin/.../Platform.kt"
interface Platform {
    val name: String
}

expect fun getPlatform(): Platform
```

```kotlin title="shared/src/jvmMain/kotlin/.../Platform.jvm.kt"
class JVMPlatform : Platform {
    override val name: String =
        "Java ${System.getProperty("java.version")}"
}

actual fun getPlatform(): Platform = JVMPlatform()
```

### Greeting â€” LÃ³gica compartilhada

```kotlin title="shared/src/commonMain/kotlin/.../Greeting.kt"
class Greeting {
    private val platform = getPlatform()

    fun greet(): String {
        return "Hello, ${platform.name}!"
    }
}
```

## ðŸ’» MÃ£o na Massa

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="ex1" label="ExercÃ­cio 1 â€” FixaÃ§Ã£o" default>

Execute o servidor com `./gradlew :server:run` e acesse `http://localhost:8080/api/health` no navegador.

  </TabItem>
  <TabItem value="ex2" label="ExercÃ­cio 2 â€” AplicaÃ§Ã£o">

Adicione um endpoint `GET /api/version` que retorne `{ "version": "1.0.0", "kmp": true }` como JSON serializado.

  </TabItem>
  <TabItem value="ex3" label="ExercÃ­cio 3 â€” Desafio">

Crie uma data class `AppInfo` no mÃ³dulo `shared/` e use-a tanto no `server/` (endpoint) quanto no `composeApp/` (UI). Isso demonstra o poder do KMP.

  </TabItem>
</Tabs>
