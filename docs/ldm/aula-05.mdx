---
sidebar_position: 5
title: "Aula 05: Auth no Server"
description: "AutenticaÃ§Ã£o com Supabase Auth â€” registro, login, JWT validation no Ktor."
---

# Aula 05: Auth no Server

:::info ðŸ”€ Branch da Aula
Esta aula refere-se Ã  branch: **`aula-05`**
```bash
git checkout aula-05
```
:::

:::caution ðŸš§ ConteÃºdo Prospectivo
Esta branch ainda nÃ£o possui cÃ³digo implementado.
:::

## ðŸ“– Conceito

O server valida tokens JWT recebidos do client. O Supabase Auth Ã© usado para registro/login, e o Ktor valida o JWT em cada requisiÃ§Ã£o protegida.

## ðŸ’» CÃ³digo de ReferÃªncia

```kotlin title="server/.../plugins/AuthPlugin.kt"
fun Application.configureAuth(supabase: SupabaseClient) {
    install(Authentication) {
        bearer("supabase-jwt") {
            authenticate { credential ->
                // Valida o JWT contra o Supabase
                val token = credential.token
                try {
                    val user = supabase.auth.retrieveUser(token)
                    UserIdPrincipal(user.id)
                } catch (e: Exception) {
                    null // Token invÃ¡lido
                }
            }
        }
    }
}
```

## ðŸ’» MÃ£o na Massa

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="ex1" label="ExercÃ­cio 1 â€” FixaÃ§Ã£o" default>

Crie endpoints `POST /auth/login` e `POST /auth/register` usando `supabase.auth`.

  </TabItem>
  <TabItem value="ex2" label="ExercÃ­cio 2 â€” AplicaÃ§Ã£o">

Proteja os endpoints de `courses` com `authenticate("supabase-jwt")`.

  </TabItem>
  <TabItem value="ex3" label="ExercÃ­cio 3 â€” Desafio">

Implemente refresh token â€” quando o access token expira, o client envia o refresh token e recebe um novo par.

  </TabItem>
</Tabs>
