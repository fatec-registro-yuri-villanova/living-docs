---
sidebar_position: 20
title: "Aula 20: APK e Play Store"
description: "Gera√ß√£o de build de release, assinatura de APK, ProGuard e prepara√ß√£o para a Play Store."
---

# Aula 20: APK e Play Store

:::info üîÄ Branch da Aula
Esta aula refere-se √† branch: **`aula-20`**
```bash
git checkout aula-20
```
:::

## üìñ Conceito

A jornada do app termina com a publica√ß√£o. Nesta aula, aprenderemos a gerar um **APK/AAB de release**, assinar o aplicativo, e preparar o envio para a **Google Play Store**.

### Build Variants

| Variant | Uso | Minify | Debug |
|---------|-----|--------|-------|
| `debug` | Desenvolvimento | ‚ùå | ‚úÖ |
| `release` | Produ√ß√£o | ‚úÖ R8/ProGuard | ‚ùå |

### Assinatura

```groovy
// build.gradle.kts
android {
    signingConfigs {
        create("release") {
            storeFile = file("keystore/release.keystore")
            storePassword = System.getenv("KEYSTORE_PASSWORD")
            keyAlias = System.getenv("KEY_ALIAS")
            keyPassword = System.getenv("KEY_PASSWORD")
        }
    }

    buildTypes {
        release {
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
            signingConfig = signingConfigs.getByName("release")
        }
    }
}
```

### Gerar AAB (Android App Bundle)

```bash
# Terminal
./gradlew bundleRelease

# Output: app/build/outputs/bundle/release/app-release.aab
```

### ProGuard/R8 ‚Äî Regras para Ktor e Kotlin Serialization

```proguard
# Ktor
-keep class io.ktor.** { *; }
-dontwarn io.ktor.**

# Kotlin Serialization
-keepattributes *Annotation*, InnerClasses
-dontnote kotlinx.serialization.AnnotationsKt
-keepclassmembers class kotlinx.serialization.json.** { *** Companion; }
-keep,includedescriptorclasses class com.example.mergeskills.** { *; }
```

## üíª C√≥digo de Refer√™ncia

```kotlin title="build.gradle.kts (app)"
android {
    namespace = "com.example.mergeskills"
    compileSdk = 34

    defaultConfig {
        applicationId = "com.example.mergeskills"
        minSdk = 26
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"
    }

    buildTypes {
        release {
            isMinifyEnabled = true
            isShrinkResources = true
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
        }
    }
}
```

## üíª M√£o na Massa

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="ex1" label="Exerc√≠cio 1 ‚Äî Fixa√ß√£o" default>

### Gere um APK de debug

Execute `./gradlew assembleDebug` e localize o APK gerado. Instale em um dispositivo f√≠sico e teste o fluxo completo.

  </TabItem>
  <TabItem value="ex2" label="Exerc√≠cio 2 ‚Äî Aplica√ß√£o">

### Configure o ProGuard

Ative `isMinifyEnabled = true` no build de release e adicione as regras de ProGuard para Ktor e Kotlin Serialization. Gere o release e verifique que o app funciona sem crashes.

  </TabItem>
  <TabItem value="ex3" label="Exerc√≠cio 3 ‚Äî Desafio">

### Prepara√ß√£o completa para a Play Store

1. Crie um keystore de release com `keytool`
2. Configure a assinatura no `build.gradle.kts` (usando vari√°veis de ambiente)
3. Gere o AAB de release
4. Prepare os assets de loja: √≠cone, screenshots, descri√ß√£o
5. Fa√ßa o upload para o Google Play Console (conta de teste)

Documente todo o processo em um `RELEASE.md` no reposit√≥rio.

  </TabItem>
</Tabs>
