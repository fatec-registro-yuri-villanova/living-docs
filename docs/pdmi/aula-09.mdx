---
sidebar_position: 9
title: "Aula 09: Estado Global com Context API"
description: "Context API para compartilhar estado entre telas â€” AuthContext, UserProvider e useAuth hook."
---

# Aula 09: Estado Global com Context API

:::info ðŸ”€ Branch da Aula
Esta aula refere-se Ã  branch: **`aula-09`**
```bash
git checkout aula-09
```
:::

:::caution ðŸš§ ConteÃºdo Prospectivo
Esta branch ainda nÃ£o possui cÃ³digo implementado. O conteÃºdo abaixo Ã© baseado no plano curricular e serÃ¡ atualizado quando o cÃ³digo for commitado.
:::

## ðŸ“– Conceito

A **Context API** do React permite compartilhar estado entre mÃºltiplos componentes sem "prop drilling". No MergeSkills, criamos um `AuthContext` que armazena o usuÃ¡rio logado e disponibiliza `signIn`, `signOut` e `user` globalmente.

### Estrutura proposta

```
lib/
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx    â† Provider + Hook
```

## ðŸ’» CÃ³digo de ReferÃªncia

### AuthContext com Provider

```tsx title="lib/contexts/AuthContext.tsx"
import React, { createContext, useContext, useState, useEffect } from 'react';
import { apiClient } from '../api';
import AsyncStorage from '@react-native-async-storage/async-storage';

interface User {
    id: number;
    name: string;
    email: string;
    profilePicture?: string;
}

interface AuthContextData {
    user: User | null;
    loading: boolean;
    signIn: (email: string, password: string) => Promise<void>;
    signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextData>({} as AuthContextData);

export function AuthProvider({ children }: { children: React.ReactNode }) {
    const [user, setUser] = useState<User | null>(null);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        loadStoredUser();
    }, []);

    async function loadStoredUser() {
        const storedUser = await AsyncStorage.getItem('@user');
        if (storedUser) setUser(JSON.parse(storedUser));
        setLoading(false);
    }

    async function signIn(email: string, password: string) {
        const response = await apiClient.auth.signIn(email, password);
        setUser(response.user);
        await AsyncStorage.setItem('@user', JSON.stringify(response.user));
    }

    async function signOut() {
        await apiClient.auth.signOut();
        setUser(null);
        await AsyncStorage.removeItem('@user');
    }

    return (
        <AuthContext.Provider value={{ user, loading, signIn, signOut }}>
            {children}
        </AuthContext.Provider>
    );
}

export const useAuth = () => useContext(AuthContext);
```

## ðŸ’» MÃ£o na Massa

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="ex1" label="ExercÃ­cio 1 â€” FixaÃ§Ã£o" default>

### Envolva o app com AuthProvider

No `_layout.tsx`, envolva o `<Stack>` com `<AuthProvider>`. Na tela de perfil, substitua os dados hardcoded por `useAuth().user`.

  </TabItem>
  <TabItem value="ex2" label="ExercÃ­cio 2 â€” AplicaÃ§Ã£o">

### Proteja rotas

Crie um componente `ProtectedRoute` que redireciona para `/login` se `user === null`.

  </TabItem>
  <TabItem value="ex3" label="ExercÃ­cio 3 â€” Desafio">

### Crie um CourseContext

Implemente `CourseContext` que carrega e disponibiliza a lista de cursos globalmente, evitando re-fetch a cada navegaÃ§Ã£o para a tab Home.

  </TabItem>
</Tabs>
